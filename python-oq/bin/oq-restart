#!/bin/bash

pkill celeryd
rm -f /tmp/celeryd.log

export MPLCONFIGDIR=/tmp
export JAVA_HOME=/usr/lib/jvm/java-6-openjdk/jre
export DJANGO_SETTINGS_MODULE="openquake.settings"

cd /usr/openquake

if [ -z "$1" ]; then
    concurrency=30
else
    concurrency=$1
fi

echo "Starting $concurrency celery workers for OpenQuake.."

celeryd -c $concurrency --purge > /tmp/celeryd.log 2>&1 3>&1 &
